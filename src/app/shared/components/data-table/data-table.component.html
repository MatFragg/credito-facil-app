<div class="data-table-container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
        <mat-spinner *ngIf="config.showLoadingSpinner" diameter="50"></mat-spinner>
        <p>{{ config.loadingMessage }}</p>
    </div>

    <!-- Table Content -->
    <div *ngIf="!isLoading" class="table-wrapper">
        <table mat-table [dataSource]="pageData()" [class]="config.tableClass"
            [class.hoverable-rows]="config.hoverableRows" [class.clickable-rows]="config.clickableRows">

            <!-- Dynamic Column Definitions -->
            <ng-container *ngFor="let column of columns" [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef [style.width]="column.width">
                    {{ column.label }}
                </th>
                <td mat-cell *matCellDef="let row" [ngClass]="getCellClass(row, column)" (click)="onRowClick(row)">

                    <!-- Text Type -->
                    <ng-container *ngIf="!column.type || column.type === 'text'">
                        {{ getCellValue(row, column) }}
                    </ng-container>

                    <!-- Number Type -->
                    <ng-container *ngIf="column.type === 'number'">
                        {{ formatNumber(getCellValue(row, column), column.decimals || 0) }}
                    </ng-container>

                    <!-- Currency Type -->
                    <ng-container *ngIf="column.type === 'currency'">
                        {{ formatCurrency(getCellValue(row, column), column.currencySymbol) }}
                    </ng-container>

                    <!-- Percentage Type -->
                    <ng-container *ngIf="column.type === 'percentage'">
                        {{ formatPercentage(getCellValue(row, column), column.decimals || 0) }}
                    </ng-container>

                    <!-- Badge Type -->
                    <ng-container *ngIf="column.type === 'badge'">
                        <span class="badge" [ngClass]="column.badgeClass ? column.badgeClass(row) : ''">
                            {{ getCellValue(row, column) }}
                        </span>
                    </ng-container>

                    <!-- Boolean Type -->
                    <ng-container *ngIf="column.type === 'boolean'">
                        <mat-icon [class.success-icon]="getCellValue(row, column)"
                            [class.error-icon]="!getCellValue(row, column)">
                            {{ getCellValue(row, column) ? 'check_circle' : 'cancel' }}
                        </mat-icon>
                    </ng-container>

                    <!-- Icon Type -->
                    <ng-container *ngIf="column.type === 'icon'">
                        <mat-icon>{{ getCellValue(row, column) }}</mat-icon>
                    </ng-container>

                    <!-- Image Type -->
                    <ng-container *ngIf="column.type === 'image'">
                        <img [src]="getCellValue(row, column)" [alt]="column.label" class="cell-image">
                    </ng-container>

                    <!-- Link Type -->
                    <ng-container *ngIf="column.type === 'link'">
                        <a [href]="column.linkUrl ? column.linkUrl(row) : getCellValue(row, column)" target="_blank">
                            {{ getCellValue(row, column) }}
                        </a>
                    </ng-container>

                    <!-- Date Type -->
                    <ng-container *ngIf="column.type === 'date'">
                        {{ getCellValue(row, column) | date: column.dateFormat || 'dd/MM/yyyy' }}
                    </ng-container>

                    <!-- Custom Type -->
                    <ng-container *ngIf="column.type === 'custom' && column.cellTemplate">
                        <div [innerHTML]="column.cellTemplate(row)"></div>
                    </ng-container>

                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions" *ngIf="actions.length > 0">
                <th mat-header-cell *matHeaderCellDef>Acciones</th>
                <td mat-cell *matCellDef="let row">
                    <div class="action-buttons">
                        <button mat-icon-button *ngFor="let action of actions" [hidden]="!isActionVisible(action, row)"
                            [disabled]="isActionDisabled(action, row)" [matTooltip]="action.tooltip"
                            [color]="action.color" (click)="onActionClick(action, row, $event)">
                            <mat-icon>{{ action.icon }}</mat-icon>
                        </button>
                    </div>
                </td>
            </ng-container>

            <!-- Table Rows -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns()"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns();" class="data-row"></tr>
        </table>

        <!-- Empty State -->
        <div *ngIf="data.length === 0" class="empty-state">
            <mat-icon class="empty-icon">inbox</mat-icon>
            <p>{{ config.emptyMessage }}</p>
        </div>

        <!-- Pagination -->
        <mat-paginator *ngIf="config.pagination?.enabled && data.length > 0" [length]="data.length"
            [pageSize]="pageSize()" [pageSizeOptions]="config.pagination?.pageSizeOptions || [5, 10, 25, 50]"
            [showFirstLastButtons]="config.pagination?.showFirstLastButtons ?? true" (page)="onPageChange($event)">
        </mat-paginator>
    </div>
</div>